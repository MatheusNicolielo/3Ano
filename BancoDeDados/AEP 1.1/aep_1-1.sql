CREATE TABLE PARCELAS(
NMR_PARCELAS number,
VALOR_POR_PARCELA NUMBER DEFAULT  0 NOT NULL,
JUROS number,
valor_final number DEFAULT  0 NOT NULL);

--DROP TABLE PARCELAS;

insert into parcelas(nmr_parcelas,JUROS) values (6,10);
insert into parcelas(nmr_parcelas,JUROS) values (12,15);
insert into parcelas(nmr_parcelas,JUROS) values (18,20);

SELECT * FROM PARCELAS;

DECLARE
    CURSOR P1 IS SELECT NMR_PARCELAS, VALOR_POR_PARCELA, JUROS, VALOR_FINAL 
    FROM PARCELAS FOR UPDATE OF VALOR_POR_PARCELA,VALOR_FINAL;
    RP1 P1%ROWTYPE;
    VALOR_COMPRA_INICIAL PARCELAS.VALOR_FINAL%TYPE := &VALORFINAL;
    VALOR_POS_ENTRADA PARCELAS.VALOR_FINAL%TYPE;
    VALOR_COM_JUROS PARCELAS.VALOR_FINAL%TYPE;
BEGIN
    OPEN P1;
    VALOR_POS_ENTRADA := VALOR_COMPRA_INICIAL*(1-(20/100));

    LOOP
        FETCH P1 INTO RP1;
        EXIT WHEN P1%NOTFOUND;
        VALOR_COM_JUROS := VALOR_POS_ENTRADA*(1+(RP1.JUROS/100));
        UPDATE PARCELAS
        SET VALOR_POR_PARCELA = VALOR_COM_JUROS/NMR_PARCELAS, valor_final = VALOR_COM_JUROS WHERE CURRENT OF C1;
    END LOOP;  
    CLOSE P1;
END;

